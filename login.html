<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>recs — sign in</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<style>
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }

:root {
  --terra: #1E3A2F;
  --terra-light: #2D5142;
  --terra-dark: #152E24;
  --cream: #F7F3EC;
  --cream-dark: #EBE5D8;
  --sand: #DDD6C8;
  --white: #FEFCF7;
  --text: #0F1E18;
  --text-2: #4A5D53;
  --text-3: #7A9085;
  --brass: #B8923A;
  --brass-light: #D4A84B;
  --radius: 16px;
  --radius-sm: 10px;
}

body {
  font-family:'DM Sans',sans-serif;
  background:var(--cream);
  color:var(--text);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:1.5rem;
}

.login-container {
  width:100%;
  max-width:400px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* Logo */
.login-logo {
  font-family:'Gill Sans','Gill Sans MT',Lato,sans-serif;
  font-weight:400;
  font-size:3.2rem;
  letter-spacing:-0.01em;
  color:var(--text);
  line-height:1;
  margin-bottom:0.5rem;
}
.login-logo .dot {
  display:inline-block;
  width:0.3em; height:0.3em;
  background:var(--brass);
  border-radius:50%;
  margin-left:0.1em;
  vertical-align:middle;
  position:relative;
  top:-0.05em;
}

.login-tagline {
  font-size:0.82rem;
  color:var(--text-3);
  letter-spacing:0.02em;
  margin-bottom:2.5rem;
}

/* Card */
.login-card {
  width:100%;
  background:var(--white);
  border-radius:var(--radius);
  border:1px solid var(--sand);
  padding:2rem 1.75rem;
  box-shadow:0 2px 12px rgba(15,30,24,0.06);
}

/* Toggle tabs */
.auth-tabs {
  display:flex;
  gap:0;
  margin-bottom:1.5rem;
  background:var(--cream);
  border-radius:var(--radius-sm);
  padding:3px;
}
.auth-tab {
  flex:1;
  padding:0.55rem 0;
  border:none;
  background:transparent;
  font-family:'DM Sans',sans-serif;
  font-size:0.8rem;
  font-weight:600;
  color:var(--text-3);
  cursor:pointer;
  border-radius:8px;
  transition:all 0.2s;
}
.auth-tab.active {
  background:var(--white);
  color:var(--terra);
  box-shadow:0 1px 4px rgba(15,30,24,0.08);
}

/* Form */
.auth-form {
  display:flex;
  flex-direction:column;
  gap:0.85rem;
}

.form-group {
  display:flex;
  flex-direction:column;
  gap:0.3rem;
}
.form-label {
  font-size:0.72rem;
  font-weight:600;
  color:var(--text-2);
  letter-spacing:0.02em;
}
.form-input {
  padding:0.65rem 0.85rem;
  border:1.5px solid var(--sand);
  border-radius:var(--radius-sm);
  background:white;
  font-family:'DM Sans',sans-serif;
  font-size:0.85rem;
  color:var(--text);
  outline:none;
  transition:border-color 0.2s;
}
.form-input:focus {
  border-color:var(--terra-light);
}
.form-input::placeholder {
  color:var(--text-3);
}

/* Name field — only visible on signup */
.name-field {
  display:none;
}
.name-field.visible {
  display:flex;
}

/* Submit button */
.auth-submit {
  padding:0.75rem;
  border:none;
  border-radius:var(--radius-sm);
  background:var(--terra);
  color:white;
  font-family:'DM Sans',sans-serif;
  font-size:0.85rem;
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s;
  margin-top:0.25rem;
}
.auth-submit:hover {
  background:var(--terra-dark);
}
.auth-submit:disabled {
  opacity:0.6;
  cursor:not-allowed;
}

/* Divider */
.auth-divider {
  display:flex;
  align-items:center;
  gap:0.75rem;
  margin:0.35rem 0;
}
.auth-divider-line {
  flex:1;
  height:1px;
  background:var(--sand);
}
.auth-divider-text {
  font-size:0.7rem;
  color:var(--text-3);
  font-weight:500;
}

/* Google button */
.auth-google {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.6rem;
  padding:0.7rem;
  border:1.5px solid var(--sand);
  border-radius:var(--radius-sm);
  background:white;
  font-family:'DM Sans',sans-serif;
  font-size:0.82rem;
  font-weight:600;
  color:var(--text);
  cursor:pointer;
  transition:all 0.2s;
}
.auth-google:hover {
  border-color:var(--terra-light);
  color:var(--terra);
}
.auth-google svg {
  width:18px;
  height:18px;
  flex-shrink:0;
}

/* Messages */
.auth-message {
  font-size:0.75rem;
  padding:0.6rem 0.75rem;
  border-radius:8px;
  display:none;
  line-height:1.4;
}
.auth-message.error {
  display:block;
  background:#FFF0EE;
  color:#9A3A3A;
  border:1px solid #F0D0CC;
}
.auth-message.success {
  display:block;
  background:#EEFAF0;
  color:#2D7A45;
  border:1px solid #C8E8CF;
}

/* Footer */
.login-footer {
  margin-top:1.75rem;
  font-size:0.7rem;
  color:var(--text-3);
  text-align:center;
}
.login-footer a {
  color:var(--terra);
  text-decoration:none;
  font-weight:600;
}
.login-footer a:hover {
  text-decoration:underline;
}

/* Loading spinner on button */
.auth-submit.loading {
  position:relative;
  color:transparent;
}
.auth-submit.loading::after {
  content:'';
  position:absolute;
  width:18px; height:18px;
  border:2px solid rgba(255,255,255,0.3);
  border-top-color:white;
  border-radius:50%;
  top:50%; left:50%;
  margin:-9px 0 0 -9px;
  animation:spin 0.6s linear infinite;
}
@keyframes spin { to { transform:rotate(360deg); } }

/* Responsive */
@media(max-width:480px) {
  .login-logo { font-size:2.6rem; }
  .login-card { padding:1.5rem 1.25rem; }
}
</style>
</head>
<body>

<div class="login-container">
  <div class="login-logo">recs<span class="dot"></span></div>
  <div class="login-tagline">share what's worth seeing</div>

  <div class="login-card">
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Log In</button>
      <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
    </div>

    <div id="authMessage" class="auth-message"></div>

    <form class="auth-form" id="authForm" onsubmit="handleSubmit(event)">
      <div class="form-group name-field" id="nameField">
        <label class="form-label">Display Name</label>
        <input class="form-input" id="nameInput" type="text" placeholder="Your name" autocomplete="name">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" id="emailInput" type="email" placeholder="you@example.com" autocomplete="email" required>
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input class="form-input" id="passwordInput" type="password" placeholder="At least 6 characters" autocomplete="current-password" required minlength="6">
      </div>
      <button class="auth-submit" id="authSubmit" type="submit">Log In</button>
    </form>

    <div class="auth-divider">
      <div class="auth-divider-line"></div>
      <span class="auth-divider-text">or</span>
      <div class="auth-divider-line"></div>
    </div>

    <button class="auth-google" onclick="handleGoogle()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/>
        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
      </svg>
      Continue with Google
    </button>
  </div>

  <div class="login-footer">
    By continuing, you agree to our terms of service.
  </div>
</div>

<script>
const SUPABASE_URL = 'https://tytqghikcwkvdordqtog.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_TVedQi8WoQwPrAos3JVZow_N3wUAVuy';

let sb = null;
let mode = 'login'; // 'login' or 'signup'

// Init Supabase
(async function init() {
  if (SUPABASE_URL.includes('YOUR_PROJECT')) {
    console.log('[recs] Supabase not configured — auth disabled');
    return;
  }

  sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // If already logged in, go to app
  const { data: { session } } = await sb.auth.getSession();
  if (session) {
    window.location.href = 'index.html';
    return;
  }

  // Listen for auth changes (handles OAuth redirect)
  sb.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_IN' && session) {
      window.location.href = 'index.html';
    }
  });
})();

function switchTab(tab) {
  mode = tab;
  const tabs = document.querySelectorAll('.auth-tab');
  tabs[0].classList.toggle('active', tab === 'login');
  tabs[1].classList.toggle('active', tab === 'signup');

  const nameField = document.getElementById('nameField');
  nameField.classList.toggle('visible', tab === 'signup');

  const submitBtn = document.getElementById('authSubmit');
  submitBtn.textContent = tab === 'login' ? 'Log In' : 'Create Account';

  const passwordInput = document.getElementById('passwordInput');
  passwordInput.autocomplete = tab === 'login' ? 'current-password' : 'new-password';
  passwordInput.placeholder = tab === 'login' ? 'Your password' : 'At least 6 characters';

  hideMessage();
}

function showMessage(text, type) {
  const el = document.getElementById('authMessage');
  el.textContent = text;
  el.className = 'auth-message ' + type;
}

function hideMessage() {
  const el = document.getElementById('authMessage');
  el.className = 'auth-message';
}

async function handleSubmit(e) {
  e.preventDefault();
  if (!sb) {
    showMessage('Supabase not configured yet. Please set up your project credentials.', 'error');
    return;
  }

  const email = document.getElementById('emailInput').value.trim();
  const password = document.getElementById('passwordInput').value;
  const name = document.getElementById('nameInput').value.trim();
  const submitBtn = document.getElementById('authSubmit');

  hideMessage();
  submitBtn.disabled = true;
  submitBtn.classList.add('loading');

  try {
    if (mode === 'signup') {
      const { data, error } = await sb.auth.signUp({
        email,
        password,
        options: {
          data: { display_name: name || email.split('@')[0] }
        }
      });

      if (error) throw error;

      if (data.user && !data.session) {
        // Email confirmation required
        showMessage('Check your email for a confirmation link to complete sign up.', 'success');
      }
      // If session exists, onAuthStateChange will handle redirect
    } else {
      const { data, error } = await sb.auth.signInWithPassword({ email, password });
      if (error) throw error;
      // onAuthStateChange will handle redirect
    }
  } catch (err) {
    showMessage(err.message || 'Something went wrong. Please try again.', 'error');
  } finally {
    submitBtn.disabled = false;
    submitBtn.classList.remove('loading');
  }
}

async function handleGoogle() {
  if (!sb) {
    showMessage('Supabase not configured yet. Please set up your project credentials.', 'error');
    return;
  }

  const { error } = await sb.auth.signInWithOAuth({
    provider: 'google',
    options: {
      redirectTo: window.location.origin + '/index.html'
    }
  });

  if (error) {
    showMessage(error.message || 'Google sign-in failed.', 'error');
  }
}
</script>

</body>
</html>
